<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Êô∫ËÉΩÂá∫Â∫ìÁÆ°ÁêÜ V6 (ÂêçÁß∞Áâà)</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. SheetJS (ExcelÂØºÂá∫) -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #F2F2F7;
            color: #1C1C1E;
            overscroll-behavior: none;
        }
        
        .animate-fade-in { animation: fadeIn 0.2s ease-out forwards; }
        .animate-scale-up { animation: scaleUp 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .pt-safe-top { padding-top: env(safe-area-inset-top); }
        .pb-safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

        /* Ë°åÈ´ò‰∫ÆÈó™ÁÉÅÂä®Áîª */
        @keyframes flashRow {
            0% { background-color: rgba(59, 130, 246, 0.2); }
            50% { background-color: rgba(59, 130, 246, 0.1); }
            100% { background-color: transparent; }
        }
        .row-highlight { animation: flashRow 1s ease-out; }

        /* Êó•ÂéÜÊ†∑Âºè */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; position: relative; font-size: 14px; font-weight: 500; color: #333; }
        .calendar-day.empty { background: transparent; pointer-events: none; }
        .calendar-day.active { background-color: white; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .calendar-day.selected { border: 2px solid #2563EB; background-color: #EFF6FF; }
        .calendar-day.today { color: #2563EB; font-weight: 900; background-color: #EFF6FF; }
        .calendar-dot { width: 4px; height: 4px; border-radius: 50%; background-color: #2563EB; margin-top: 2px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ÂõæÊ†áÁªÑ‰ª∂ ---
        const Icons = {
            Package: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>,
            Save: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            History: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20v-6M6 20V10M18 20V4"/></svg>,
            Trash: ({size=18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Plus: ({size=18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Minus: ({size=18}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            X: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Share: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>,
            Copy: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            ChevronLeft: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
            ChevronRight: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Info: ({size=20}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>,
            AlertTriangle: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
            Today: ({size=16}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M12 14h.01"/></svg>
        };

        // --- Á°ÆËÆ§ÂºπÁ™ó & Toast ---
        const ConfirmModal = ({ isOpen, title, content, onConfirm, onCancel, confirmText="Á°ÆËÆ§", cancelText="ÂèñÊ∂à", isDangerous=false }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[1000] flex items-center justify-center p-6 animate-fade-in">
                    <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={onCancel}></div>
                    <div className="bg-white rounded-2xl w-full max-w-xs p-6 relative z-10 shadow-2xl animate-scale-up">
                        <div className={`mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 ${isDangerous ? 'bg-red-50 text-red-500' : 'bg-blue-50 text-blue-500'}`}>
                            {isDangerous ? <Icons.AlertTriangle /> : <Icons.Info />}
                        </div>
                        <h3 className="text-lg font-bold text-gray-900 text-center mb-2">{title}</h3>
                        <p className="text-sm text-gray-500 text-center mb-6 leading-relaxed">{content}</p>
                        <div className="flex gap-3">
                            <button onClick={onCancel} className="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl text-sm">{cancelText}</button>
                            <button onClick={onConfirm} className={`flex-1 py-3 text-white font-bold rounded-xl shadow-lg text-sm ${isDangerous ? 'bg-red-500 shadow-red-200' : 'bg-blue-600 shadow-blue-200'}`}>{confirmText}</button>
                        </div>
                    </div>
                </div>
            );
        };

        const Toast = ({ show, message, type = 'success' }) => {
            if (!show) return null;
            return (
                <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[1100] animate-fade-in pointer-events-none">
                    <div className={`px-5 py-2.5 rounded-full shadow-xl flex items-center gap-2 text-sm font-bold text-white backdrop-blur-md ${type === 'success' ? 'bg-black/80' : 'bg-red-500/90'}`}>
                        {type === 'success' ? <Icons.Info size={16}/> : <Icons.AlertTriangle size={16}/>}
                        {message}
                    </div>
                </div>
            );
        };

        // --- Êô∫ËÉΩÂêçÁß∞ËæìÂÖ•ÁªÑ‰ª∂ ---
        const SmartNameInput = ({ onAdd, priceDB, currentInput, setCurrentInput }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            useEffect(() => {
                if (!currentInput.trim()) {
                    setSuggestions([]);
                    return;
                }
                // ÁÆÄÂçïÁöÑÊ®°Á≥äÂåπÈÖç
                const query = currentInput.toLowerCase();
                const matched = Object.keys(priceDB).filter(name => name.toLowerCase().includes(query)).slice(0, 5);
                setSuggestions(matched);
                setShowSuggestions(matched.length > 0);
            }, [currentInput, priceDB]);

            const handleSelect = (name) => {
                onAdd(name);
                setCurrentInput('');
                setShowSuggestions(false);
            };

            return (
                <div className="relative flex-1 z-20">
                    <input 
                        type="text" 
                        className="w-full bg-gray-100 rounded-lg px-3 text-sm outline-none h-12 focus:ring-2 focus:ring-blue-100 transition-all font-bold"
                        placeholder="ËæìÂÖ•ÂïÜÂìÅÂêçÁß∞ (Ëá™Âä®ËÆ∞ÂøÜ)"
                        value={currentInput}
                        onChange={e => { setCurrentInput(e.target.value); setShowSuggestions(true); }}
                        onFocus={() => { if(currentInput) setShowSuggestions(true); }}
                        onKeyDown={e => { if(e.key === 'Enter' && currentInput) { onAdd(currentInput); setCurrentInput(''); setShowSuggestions(false); } }}
                    />
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-1 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden animate-fade-in">
                            <div className="bg-gray-50 px-3 py-1 text-[10px] text-gray-400 font-bold uppercase tracking-wider">ÂéÜÂè≤ÂïÜÂìÅ</div>
                            {suggestions.map((name) => (
                                <div key={name} 
                                    className="p-3 border-b border-gray-50 last:border-0 hover:bg-blue-50 cursor-pointer flex justify-between items-center"
                                    onMouseDown={(e) => { e.preventDefault(); handleSelect(name); }} 
                                >
                                    <span className="font-bold text-sm text-gray-800">{name}</span>
                                    <span className="text-gray-400 text-xs">¬•{priceDB[name]}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            // --- Êï∞ÊçÆÁä∂ÊÄÅ ---
            // priceDB: { "ÂèØ‰πê": 3.0, "ËñØÁâá": 5.0 } - ÁÆÄÂçïÁöÑÂêçÁß∞Âà∞‰ª∑Ê†ºÊò†Â∞Ñ
            const [priceDB, setPriceDB] = useState(() => JSON.parse(localStorage.getItem('inventory_price_db')) || {});
            const [currentOrder, setCurrentOrder] = useState(() => JSON.parse(localStorage.getItem('inventory_current_order')) || []);
            const [orderHistory, setOrderHistory] = useState(() => JSON.parse(localStorage.getItem('inventory_history')) || []);

            // --- UI Áä∂ÊÄÅ ---
            const [activeTab, setActiveTab] = useState('current');
            const [inputName, setInputName] = useState("");
            const [lastAddedId, setLastAddedId] = useState(null);
            
            // ÂºπÁ™óÁä∂ÊÄÅ
            const [modalConfig, setModalConfig] = useState({ isOpen: false });
            const [toastConfig, setToastConfig] = useState({ show: false, message: '', type: 'success' });

            // ÁªüËÆ°È°µÁä∂ÊÄÅ
            const [currentDate, setCurrentDate] = useState(new Date()); 
            const [selectedDayDetail, setSelectedDayDetail] = useState(null);

            // --- ÊåÅ‰πÖÂåñ ---
            useEffect(() => { localStorage.setItem('inventory_current_order', JSON.stringify(currentOrder)); }, [currentOrder]);
            useEffect(() => { localStorage.setItem('inventory_history', JSON.stringify(orderHistory)); }, [orderHistory]);
            useEffect(() => { localStorage.setItem('inventory_price_db', JSON.stringify(priceDB)); }, [priceDB]);

            const showToast = (msg, type = 'success') => {
                setToastConfig({ show: true, message: msg, type });
                setTimeout(() => setToastConfig(prev => ({ ...prev, show: false })), 2000);
            };

            // --- Ê†∏ÂøÉÈÄªËæë: Ê∑ªÂä†ÂïÜÂìÅ (ÊåâÂêçÁß∞) ---
            const addItemToOrder = (name) => {
                if (!name.trim()) return;
                const finalName = name.trim();
                const now = Date.now();
                
                // Êü•ÊâæÊòØÂê¶Â∑≤Âú®ÂΩìÂâçÂçïÊçÆ‰∏≠
                const existingIndex = currentOrder.findIndex(item => item.name === finalName);

                if (existingIndex !== -1) {
                    const newOrder = [...currentOrder];
                    newOrder[existingIndex].qty += 1;
                    setCurrentOrder(newOrder);
                    setLastAddedId(newOrder[existingIndex].id);
                } else {
                    // Êñ∞Â¢û‰∏ÄË°å
                    const defaultPrice = priceDB[finalName] || 0; // Ëá™Âä®ËØªÂèñÂéÜÂè≤‰ª∑Ê†º
                    const newItem = { id: now, name: finalName, price: defaultPrice, qty: 1 };
                    setCurrentOrder([newItem, ...currentOrder]); // Êñ∞Â¢ûÁöÑÊîæÊúÄ‰∏äÈù¢
                    setLastAddedId(newItem.id);
                }
                
                setTimeout(() => setLastAddedId(null), 800);
                if (navigator.vibrate) navigator.vibrate(50);
            };

            // --- ‰øÆÊîπÂΩìÂâçÂçïÊçÆ ---
            const updateCurrentItem = (id, field, value) => {
                setCurrentOrder(prev => prev.map(item => {
                    if (item.id === id) {
                        const updated = { ...item, [field]: value };
                        // Â¶ÇÊûú‰øÆÊîπ‰∫Ü‰ª∑Ê†ºÔºåËá™Âä®Êõ¥Êñ∞Âà∞ÂéÜÂè≤‰ª∑Ê†ºÂ∫ì (Ëá™Âä®Â≠¶‰π†)
                        if (field === 'price') {
                            setPriceDB(prevDB => ({ ...prevDB, [item.name]: Number(value) }));
                        }
                        return updated;
                    }
                    return item;
                }));
            };

            const deleteCurrentItem = (id) => {
                setModalConfig({
                    isOpen: true, title: "ÁßªÈô§ÂïÜÂìÅ", content: "Á°ÆÂÆö‰ªéÊ∏ÖÂçï‰∏≠ÁßªÈô§ÂêóÔºü", isDangerous: true,
                    onConfirm: () => { setCurrentOrder(prev => prev.filter(item => item.id !== id)); setModalConfig({isOpen:false}); },
                    onCancel: () => setModalConfig({isOpen:false})
                });
            };

            const saveCurrentOrder = () => {
                if (currentOrder.length === 0) return showToast("Ê∏ÖÂçï‰∏∫Á©∫", "error");
                setModalConfig({
                    isOpen: true, title: "Á°ÆËÆ§ÂΩíÊ°£", content: `ÂÖ± ${currentOrder.length} È°πÂïÜÂìÅÔºåÂç≥Â∞Ü‰øùÂ≠ò„ÄÇ`,
                    onConfirm: () => {
                        const totalQty = currentOrder.reduce((sum, i) => sum + Number(i.qty), 0);
                        const totalAmount = currentOrder.reduce((sum, i) => sum + (Number(i.price) * Number(i.qty)), 0);
                        const newRecord = { id: Date.now(), date: Date.now(), totalQty, totalAmount, items: [...currentOrder] };
                        setOrderHistory([newRecord, ...orderHistory]);
                        setCurrentOrder([]); setModalConfig({isOpen:false}); showToast("ÂΩíÊ°£ÊàêÂäü");
                    },
                    onCancel: () => setModalConfig({isOpen:false})
                });
            };

            // --- ÁªüËÆ°Êï∞ÊçÆËÆ°ÁÆó (ÁßªÊ§çËá™ scanKuaidi) ---
            const statsData = useMemo(() => {
                const now = new Date();
                const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
                const todayEnd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59).getTime();
                const monthStart = new Date(now.getFullYear(), now.getMonth(), 1).getTime();
                const yearStart = new Date(now.getFullYear(), 0, 1).getTime();

                // ÊâÅÂπ≥ÂåñÊâÄÊúâÂéÜÂè≤ÂçïÊçÆ‰∏≠ÁöÑÂïÜÂìÅÔºåÊñπ‰æøÊåâÊó∂Èó¥Á≠õÈÄâ
                // Ê≥®ÊÑèÔºöorderHistory ÊòØÊåâÂçïÊçÆÂ≠òÁöÑÔºåÊàë‰ª¨ÈúÄË¶ÅÊääÊØè‰∏ÄÂçïÁöÑÊó∂Èó¥Â±ûÊÄßËµã‰∫àÂÖ∂Â≠êÈ°πÔºåÊàñËÄÖÁõ¥Êé•ÁªüËÆ°ÂçïÊçÆ
                // ËøôÈáåÊàë‰ª¨ÁªüËÆ°ÁöÑÊòØ‚ÄúÂá∫Â∫ìÊÄªÈáè‚Äù
                
                let todayCount = 0, monthCount = 0, yearCount = 0;
                
                orderHistory.forEach(order => {
                    const t = order.date;
                    if (t >= todayStart && t <= todayEnd) todayCount += order.totalQty;
                    if (t >= monthStart) monthCount += order.totalQty;
                    if (t >= yearStart) yearCount += order.totalQty;
                });

                // Êó•ÂéÜÊï∞ÊçÆÊûÑÂª∫
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const firstDayWeek = new Date(year, month, 1).getDay();
                
                const calendarDays = [];
                for(let i=0; i<firstDayWeek; i++) calendarDays.push({ empty: true });
                
                for(let d=1; d<=daysInMonth; d++) {
                    const dayStart = new Date(year, month, d).getTime();
                    const dayEnd = new Date(year, month, d, 23, 59, 59).getTime();
                    
                    // ÊâæÂá∫ÂΩìÂ§©ÁöÑÊâÄÊúâÂçïÊçÆ
                    const dayOrders = orderHistory.filter(o => o.date >= dayStart && o.date <= dayEnd);
                    const dayTotal = dayOrders.reduce((sum, o) => sum + o.totalQty, 0);
                    const dayAmount = dayOrders.reduce((sum, o) => sum + o.totalAmount, 0);
                    
                    calendarDays.push({ 
                        day: d, 
                        date: new Date(year, month, d), 
                        count: dayTotal, 
                        amount: dayAmount,
                        hasData: dayTotal > 0,
                        orders: dayOrders
                    });
                }

                return { todayCount, monthCount, yearCount, calendarDays };
            }, [orderHistory, currentDate]);

            // ÈÄâ‰∏≠ÁöÑÊó•ÊúüÁöÑËØ¶ÊÉÖÂàóË°®
            const selectedDayDetails = useMemo(() => {
                if (!selectedDayDetail) return [];
                const targetDay = statsData.calendarDays.find(d => !d.empty && d.date.getTime() === selectedDayDetail);
                if (!targetDay) return [];
                // Â∞ÜËØ•Êó•ÊâÄÊúâÂçïÊçÆÁöÑÂïÜÂìÅÂêàÂπ∂Â±ïÁ§∫ÔºåÊàñËÄÖÊåâÂçïÊçÆÂ±ïÁ§∫
                // ËøôÈáåÊåâÂçïÊçÆÂ±ïÁ§∫Êõ¥Ê∏ÖÊô∞
                return targetDay.orders;
            }, [selectedDayDetail, statsData]);

            // --- ÂØºËà™ ---
            const navigateDate = (dir) => {
                const newDate = new Date(currentDate);
                newDate.setMonth(newDate.getMonth() + dir);
                setCurrentDate(newDate);
                setSelectedDayDetail(null);
            };
            const goToToday = () => {
                setCurrentDate(new Date());
                setSelectedDayDetail(null);
            };

            // --- ÂØºÂá∫‰∏éÂ§çÂà∂ (‰øÆÂ§ç) ---
            const copyOrderText = (orderItems, dateStr = "ÂΩìÂâç") => {
                if (!orderItems || orderItems.length === 0) return showToast("Êó†Êï∞ÊçÆ", "error");
                
                const tQty = orderItems.reduce((s, i) => s + Number(i.qty), 0);
                const tAmt = orderItems.reduce((s, i) => s + (Number(i.price) * Number(i.qty)), 0);
                
                let text = `üìÖ Âá∫Â∫ìÂçï (${dateStr})\n`;
                text += `----------------\n`;
                orderItems.forEach(item => {
                    const subtotal = (Number(item.price) * Number(item.qty)).toFixed(2);
                    text += `${item.name}\n`;
                    text += `   x${item.qty}  (¬•${item.price}/‰∏™)  = ¬•${subtotal}\n`;
                });
                text += `----------------\n`;
                text += `ÊÄªÊï∞Èáè: ${tQty}\n`;
                text += `ÊÄªÈáëÈ¢ù: ¬•${tAmt.toFixed(2)}\n`;

                const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); 
                try { document.execCommand('copy'); showToast("ÂÆåÊï¥Ê∏ÖÂçïÂ∑≤Â§çÂà∂"); } catch(e) { showToast("Â§çÂà∂Â§±Ë¥•", "error"); }
                document.body.removeChild(ta);
            };

            const exportOrderExcel = (orderItems, filename) => {
                const data = orderItems.map(i => ({"ÂïÜÂìÅÂêçÁß∞":i.name, "Âçï‰ª∑":i.price, "Êï∞Èáè":i.qty, "Â∞èËÆ°":(i.price*i.qty).toFixed(2)}));
                data.push({"ÂïÜÂìÅÂêçÁß∞":"ÊÄªËÆ°", "Êï∞Èáè":orderItems.reduce((s,i)=>s+Number(i.qty),0), "Â∞èËÆ°":orderItems.reduce((s,i)=>s+(i.price*i.qty),0).toFixed(2)});
                const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                XLSX.writeFile(wb, filename+".xlsx");
            };

            const currentTotalAmount = currentOrder.reduce((sum, i) => sum + (i.price * i.qty), 0).toFixed(2);

            return (
                <div className="min-h-screen bg-gray-50 flex flex-col pb-20 max-w-lg mx-auto shadow-2xl relative overflow-hidden">
                    <ConfirmModal {...modalConfig} />
                    <Toast {...toastConfig} />

                    {/* È°∂ÈÉ®Ê†è */}
                    <div className="bg-white border-b border-gray-200 sticky top-0 z-30 pt-safe-top">
                        <div className="px-4 h-14 flex items-center justify-between">
                            <h1 className="font-bold text-lg text-slate-800">
                                {activeTab === 'current' ? 'Âá∫Â∫ìÂºÄÂçï' : 'ÁªüËÆ°Êä•Ë°®'}
                            </h1>
                            {activeTab === 'history' && (
                                <button onClick={goToToday} className="text-xs font-bold bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full flex items-center gap-1">
                                    <Icons.Today size={14}/> Âõû‰ªäÂ§©
                                </button>
                            )}
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto">
                        
                        {/* Tab 1: ÂºÄÂçï */}
                        {activeTab === 'current' && (
                            <div className="flex flex-col min-h-full">
                                <div className="p-3 bg-white border-b border-gray-100 flex gap-2 items-center sticky top-0 z-20">
                                    <SmartNameInput 
                                        priceDB={priceDB} 
                                        currentInput={inputName} 
                                        setCurrentInput={setInputName} 
                                        onAdd={addItemToOrder}
                                    />
                                    <button onClick={() => {if(inputName) {addItemToOrder(inputName); setInputName('');}}} className="bg-blue-600 text-white px-5 h-12 rounded-lg font-bold text-sm shadow-sm active:scale-95 transition-transform">
                                        Ê∑ªÂä†
                                    </button>
                                </div>

                                <div className="p-3 space-y-3 pb-32">
                                    {currentOrder.length === 0 ? (
                                        <div className="text-center py-20 text-gray-400 text-sm">
                                            ÊöÇÊó†ÂïÜÂìÅ<br/>ËØ∑ËæìÂÖ•ÂêçÁß∞Ê∑ªÂä†Ôºå‰ª∑Ê†ºËá™Âä®ËÆ∞ÂøÜ
                                        </div>
                                    ) : (
                                        currentOrder.map(item => (
                                            <div key={item.id} className={`bg-white rounded-xl p-3 shadow-sm border border-gray-100 transition-all duration-500 ${lastAddedId === item.id ? 'row-highlight ring-2 ring-blue-400 border-blue-400' : ''}`}>
                                                <div className="flex justify-between items-start mb-3">
                                                    <div className="flex-1 mr-2">
                                                        <input type="text" className="font-bold text-lg w-full outline-none bg-transparent text-slate-800" value={item.name} onChange={e => updateCurrentItem(item.id, 'name', e.target.value)} />
                                                    </div>
                                                    <button onClick={() => deleteCurrentItem(item.id)} className="text-gray-300 p-1 hover:text-red-500"><Icons.Trash /></button>
                                                </div>
                                                <div className="flex justify-between items-center bg-gray-50 p-2 rounded-lg">
                                                    <div className="flex items-center gap-1">
                                                        <span className="text-gray-400 text-xs">¬•</span>
                                                        <input type="number" className="w-16 bg-transparent font-bold text-slate-700 outline-none border-b border-transparent focus:border-blue-300" 
                                                            value={item.price} 
                                                            onChange={e => updateCurrentItem(item.id, 'price', e.target.value)} 
                                                            placeholder="0.00" 
                                                        />
                                                    </div>
                                                    <div className="flex items-center gap-2">
                                                        <button className="w-8 h-8 bg-white border rounded-lg flex items-center justify-center active:bg-gray-200 shadow-sm" onClick={() => updateCurrentItem(item.id, 'qty', Math.max(1, Number(item.qty) - 1))}><Icons.Minus size={16}/></button>
                                                        {/* Êï∞ÈáèËæìÂÖ•Ê°ÜÔºöÂÖÅËÆ∏ÊâãÂä®ËæìÂÖ• */}
                                                        <input 
                                                            type="number" 
                                                            className="w-12 text-center bg-transparent font-bold text-lg outline-none"
                                                            value={item.qty}
                                                            onChange={e => updateCurrentItem(item.id, 'qty', e.target.value)}
                                                            onClick={e => e.target.select()}
                                                        />
                                                        <button className="w-8 h-8 bg-white border rounded-lg flex items-center justify-center active:bg-gray-200 shadow-sm" onClick={() => updateCurrentItem(item.id, 'qty', Number(item.qty) + 1)}><Icons.Plus size={16}/></button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}

                        {/* Tab 2: ÁªüËÆ° (Êó•ÂéÜÁâà) */}
                        {activeTab === 'history' && (
                            <div className="p-4 space-y-4 pb-24 animate-fade-in">
                                {/* Ê¶ÇËßàÂç°Áâá */}
                                <div className="grid grid-cols-3 gap-3">
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 text-center">
                                        <div className="text-xs text-gray-400 mb-1">‰ªäÊó•Âá∫Â∫ì</div>
                                        <div className="text-xl font-bold text-gray-700">{statsData.todayCount}</div>
                                    </div>
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 text-center relative overflow-hidden">
                                        <div className="absolute top-0 right-0 w-4 h-4 bg-blue-500 rounded-bl-lg"></div>
                                        <div className="text-xs text-gray-400 mb-1">Êú¨ÊúàÁ¥ØËÆ°</div>
                                        <div className="text-xl font-bold text-blue-600">{statsData.monthCount}</div>
                                    </div>
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 text-center">
                                        <div className="text-xs text-gray-400 mb-1">Êú¨Âπ¥Á¥ØËÆ°</div>
                                        <div className="text-xl font-bold text-slate-800">{statsData.yearCount}</div>
                                    </div>
                                </div>

                                {/* Êó•ÂéÜÁªÑ‰ª∂ */}
                                <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-center mb-4">
                                        <button onClick={() => navigateDate(-1)} className="p-2 text-gray-400 hover:bg-gray-50 rounded-lg"><Icons.ChevronLeft size={20} /></button>
                                        <span className="font-bold text-lg text-slate-800">{currentDate.getFullYear()}Âπ¥ {currentDate.getMonth() + 1}Êúà</span>
                                        <button onClick={() => navigateDate(1)} className="p-2 text-gray-400 hover:bg-gray-50 rounded-lg"><Icons.ChevronRight size={20} /></button>
                                    </div>
                                    <div className="grid grid-cols-7 mb-2 text-center text-xs text-gray-400 font-medium"><div>Êó•</div><div>‰∏Ä</div><div>‰∫å</div><div>‰∏â</div><div>Âõõ</div><div>‰∫î</div><div>ÂÖ≠</div></div>
                                    <div className="calendar-grid">
                                        {statsData.calendarDays.map((item, idx) => (
                                            item.empty ? <div key={idx} className="calendar-day empty"></div> : 
                                            <div key={idx} 
                                                className={`calendar-day ${item.hasData ? 'active cursor-pointer hover:bg-blue-50' : ''} ${selectedDayDetail === item.date.getTime() ? 'selected' : ''} ${new Date().toDateString() === item.date.toDateString() ? 'today' : ''}`} 
                                                onClick={() => item.hasData && setSelectedDayDetail(item.date.getTime())}
                                            >
                                                <span>{item.day}</span>
                                                {item.hasData && (
                                                    <>
                                                        <div className="calendar-dot"></div>
                                                        <div className="text-[9px] text-gray-400 scale-90 mt-[-2px]">{item.count}</div>
                                                    </>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* ÈÄâ‰∏≠Êó•ÊúüÁöÑËØ¶ÊÉÖ */}
                                {selectedDayDetails.length > 0 && (
                                    <div className="animate-slide-up space-y-3">
                                        <div className="text-xs font-bold text-gray-400 pl-1">
                                            {new Date(selectedDayDetail).getMonth()+1}Êúà{new Date(selectedDayDetail).getDate()}Êó• ËÆ∞ÂΩï ({selectedDayDetails.length}Âçï)
                                        </div>
                                        {selectedDayDetails.map(order => (
                                            <div key={order.id} className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                                                <div className="flex justify-between items-center mb-3 pb-2 border-b border-gray-50">
                                                    <span className="text-xs text-gray-400">{new Date(order.date).toLocaleTimeString()}</span>
                                                    <div className="flex gap-2">
                                                        <button onClick={() => copyOrderText(order.items, new Date(order.date).toLocaleString())} className="text-blue-600 bg-blue-50 px-2 py-1 rounded text-xs font-bold">Â§çÂà∂Ê∏ÖÂçï</button>
                                                    </div>
                                                </div>
                                                <div className="space-y-2 mb-3">
                                                    {order.items.map((it, idx) => (
                                                        <div key={idx} className="flex justify-between text-sm items-center">
                                                            <span className="text-gray-700 font-medium">{it.name}</span>
                                                            <div className="flex items-center gap-2">
                                                                <span className="text-gray-400 text-xs">¬•{it.price}</span>
                                                                <span className="text-slate-800 font-bold">x{it.qty}</span>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex justify-between items-center text-sm font-bold pt-2 border-t border-gray-50">
                                                    <span>ÊÄªËÆ°</span>
                                                    <span className="text-blue-600">¬• {order.totalAmount.toFixed(2)}</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Â∫ïÈÉ®ÁªìÁÆóÊ†è */}
                    {activeTab === 'current' && (
                        <div className="absolute bottom-16 left-4 right-4 bg-white/90 backdrop-blur-md border border-gray-200 shadow-lg rounded-2xl p-3 pb-safe-bottom z-40 animate-slide-up">
                            <div className="flex justify-between items-center mb-3 px-1">
                                <span className="text-sm text-gray-500 font-medium">Êú¨ÂçïÂêàËÆ°</span>
                                <span className="text-xl font-bold text-red-600">¬• {currentTotalAmount}</span>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={() => copyOrderText(currentOrder)} className="flex-1 py-3 bg-blue-50 text-blue-600 font-bold rounded-xl flex items-center justify-center gap-1 text-sm active:scale-95 transition-transform">
                                    <Icons.Copy size={16} /> Â§çÂà∂
                                </button>
                                <button onClick={() => exportOrderExcel(currentOrder, `Âá∫Â∫ìÂçï_${Date.now()}`)} className="w-12 bg-green-50 text-green-600 rounded-xl flex items-center justify-center active:scale-95 transition-transform">
                                    <Icons.Share size={16} />
                                </button>
                                <button onClick={saveCurrentOrder} className="flex-[1.5] py-3 bg-blue-600 text-white font-bold rounded-xl flex items-center justify-center gap-1 shadow-lg shadow-blue-500/30 text-sm active:scale-95 transition-transform">
                                    <Icons.Save size={16} /> ÂΩíÊ°£
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Â∫ïÈÉ®ÂØºËà™ */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 pb-safe-bottom z-50 h-16 flex items-center justify-around max-w-lg mx-auto">
                        <button onClick={() => setActiveTab('current')} className={`flex flex-col items-center gap-1 w-16 ${activeTab === 'current' ? 'text-blue-600' : 'text-gray-400'}`}>
                            <Icons.Package size={24} />
                            <span className="text-[10px] font-medium">ÂºÄÂçï</span>
                        </button>
                        <button onClick={() => setActiveTab('history')} className={`flex flex-col items-center gap-1 w-16 ${activeTab === 'history' ? 'text-blue-600' : 'text-gray-400'}`}>
                            <Icons.History size={24} />
                            <span className="text-[10px] font-medium">Êä•Ë°®</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>