<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ™ºèƒ½å‡ºåº“ç®¡ç† V2.3 (å®Œç¾ä¿®å¤ç‰ˆ)</title>

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 3. SheetJS (Excelå¯¼å‡º) -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            background-color: #F2F2F7;
            color: #1C1C1E;
            overscroll-behavior: none;
        }

        .animate-fade-in {
            animation: fadeIn 0.2s ease-out forwards;
        }

        .animate-scale-up {
            animation: scaleUp 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .animate-slide-up {
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        .animate-slide-in-right {
            animation: slideInRight 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes scaleUp {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }

            to {
                transform: translateY(0);
            }
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }

            to {
                transform: translateX(0);
            }
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .pt-safe-top {
            padding-top: env(safe-area-inset-top);
        }

        .pb-safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* è¡Œé«˜äº®é—ªçƒåŠ¨ç”» */
        @keyframes flashRow {
            0% {
                background-color: rgba(59, 130, 246, 0.2);
            }

            50% {
                background-color: rgba(59, 130, 246, 0.1);
            }

            100% {
                background-color: transparent;
            }
        }

        .row-highlight {
            animation: flashRow 1s ease-out;
        }

        /* æ—¥å†æ ·å¼ */
        /* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ï¼Œåªä¿®æ”¹å’Œæ·»åŠ ä»¥ä¸‹éƒ¨åˆ† */

        /* 1. åŠ å¼ºâ€œä»Šå¤©â€çš„è§†è§‰æƒé‡ */
        .calendar-day.today {
            color: white !important;
            font-weight: 900;
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4) !important;
            position: relative;
            z-index: 10;
        }

        /* å¯é€‰ï¼šç»™ä»Šå¤©åŠ ä¸ªå°è§’æ ‡æ›´é†’ç›® */
        .calendar-day.today::after {
            content: "ä»Š";
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 8px;
            font-weight: bold;
            color: white;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            padding: 1px 3px;
            line-height: 1;
        }

        /* 2. é€‰ä¸­æ—¥æœŸä¿æŒé«˜å¯¹æ¯”ï¼ˆè“è‰²è¾¹æ¡† + æµ…è“åº•ï¼‰ */
        .calendar-day.selected {
            border: 2px solid #2563EB;
            background-color: #EFF6FF !important;
            font-weight: bold;
        }

        /* 3. æœ‰æ•°æ®çš„æ—¥å­ä¿æŒæµ…ç°åº•ï¼ˆä¸èƒ½ç›–ä½ä»Šå¤©ï¼‰ */
        .calendar-day.active {
            background-color: #FAFAFA;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        /* ç¡®ä¿ä»Šå¤©æ°¸è¿œæ˜¯æœ€é†’ç›®çš„ */
        .calendar-day.today.active {
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- GitHub é£æ ¼æ—¶é—´æ˜¾ç¤ºå·¥å…· ---
        const timeAgo = (dateInput) => {
            if (!dateInput) return "";
            try {
                const date = new Date(dateInput);
                const now = new Date();
                const seconds = Math.floor((now - date) / 1000);

                if (seconds < 60) return "åˆšåˆš";
                const minutes = Math.floor(seconds / 60);
                if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
                const hours = Math.floor(minutes / 60);
                if (hours < 24) return `${hours}å°æ—¶å‰`;
                const days = Math.floor(hours / 24);
                if (days < 30) return `${days}å¤©å‰`;
                const months = Math.floor(days / 30);
                if (months < 12) return `${months}ä¸ªæœˆå‰`;
                return `${Math.floor(months / 12)}å¹´å‰`;
            } catch (e) { return ""; }
        };

        // --- å›¾æ ‡ç»„ä»¶ ---
        const Icons = {
            Package: ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>,
            Save: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
            History: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20v-6M6 20V10M18 20V4" /></svg>,
            Trash: ({ size = 18 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>,
            Plus: ({ size = 18 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            Minus: ({ size = 18 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            X: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg>,
            Share: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>,
            Copy: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>,
            ChevronLeft: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>,
            ChevronRight: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Info: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>,
            AlertTriangle: ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
            Today: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="M12 14h.01" /></svg>,
            Settings: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>,
            Download: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" y1="15" x2="12" y2="3" /></svg>,
            Upload: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></svg>,
            ChevronDown: ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>,
            ChevronUp: ({ size = 24 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>,
            Clock: ({ size = 14 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>,
            Edit: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>,
            MessageSquare: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
        };

        // --- ç¡®è®¤å¼¹çª— ---
        const ConfirmModal = ({ isOpen, title, content, onConfirm, onCancel, confirmText = "ç¡®è®¤", cancelText = "å–æ¶ˆ", isDangerous = false }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[1000] flex items-center justify-center p-6 animate-fade-in">
                    <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={onCancel}></div>
                    <div className="bg-white rounded-2xl w-full max-w-xs p-6 relative z-10 shadow-2xl animate-scale-up">
                        <div className={`mx-auto w-12 h-12 rounded-full flex items-center justify-center mb-4 ${isDangerous ? 'bg-red-50 text-red-500' : 'bg-blue-50 text-blue-500'}`}>
                            {isDangerous ? <Icons.AlertTriangle /> : <Icons.Info />}
                        </div>
                        <h3 className="text-lg font-bold text-gray-900 text-center mb-2">{title}</h3>
                        <p className="text-sm text-gray-500 text-center mb-6 leading-relaxed">{content}</p>
                        <div className="flex gap-3">
                            <button onClick={onCancel} className="flex-1 py-3 bg-gray-100 text-gray-700 font-bold rounded-xl text-sm">{cancelText}</button>
                            <button onClick={onConfirm} className={`flex-1 py-3 text-white font-bold rounded-xl shadow-lg text-sm ${isDangerous ? 'bg-red-500 shadow-red-200' : 'bg-blue-600 shadow-blue-200'}`}>{confirmText}</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Toast æç¤º ---
        const Toast = ({ show, message, type = 'success' }) => {
            if (!show) return null;
            return (
                <div className="fixed top-20 left-1/2 transform -translate-x-1/2 z-[1100] animate-fade-in pointer-events-none">
                    <div className={`px-5 py-2.5 rounded-full shadow-xl flex items-center gap-2 text-sm font-bold text-white backdrop-blur-md ${type === 'success' ? 'bg-black/80' : 'bg-red-500/90'}`}>
                        {type === 'success' ? <Icons.Info size={16} /> : <Icons.AlertTriangle size={16} />}
                        {message}
                    </div>
                </div>
            );
        };

        // --- æ™ºèƒ½åç§°è¾“å…¥ç»„ä»¶ ---
        const SmartNameInput = ({ onAdd, goodsList, priceDB, usageHistory, currentInput, setCurrentInput }) => {
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            useEffect(() => {
                if (!currentInput.trim()) { setSuggestions([]); return; }
                const query = currentInput.toLowerCase();
                let matched = goodsList.filter(name => name.toLowerCase().includes(query));
                matched.sort((a, b) => (usageHistory[b] || 0) - (usageHistory[a] || 0));
                setSuggestions(matched.slice(0, 5));
                setShowSuggestions(matched.length > 0);
            }, [currentInput, goodsList, usageHistory]);

            const handleSelect = (name) => { onAdd(name); setCurrentInput(''); setShowSuggestions(false); };

            return (
                <div className="relative flex-1 z-20">
                    <input type="text" className="w-full bg-gray-100 rounded-lg px-3 text-sm outline-none h-12 focus:ring-2 focus:ring-blue-100 transition-all font-bold" placeholder="è¾“å…¥å•†å“åç§°" value={currentInput} onChange={e => { setCurrentInput(e.target.value); setShowSuggestions(true); }} onFocus={() => { if (currentInput) setShowSuggestions(true); }} onKeyDown={e => { if (e.key === 'Enter' && currentInput) { onAdd(currentInput); setCurrentInput(''); setShowSuggestions(false); } }} />
                    {showSuggestions && suggestions.length > 0 && (
                        <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden animate-fade-in z-50">
                            <div className="bg-gray-50 px-3 py-1.5 text-[10px] text-gray-400 font-bold uppercase tracking-wider flex justify-between"><span>è”æƒ³æ¨è</span><span>æŒ‰æœ€è¿‘ä½¿ç”¨æ’åº</span></div>
                            <div className="max-h-60 overflow-y-auto">
                                {suggestions.map((name) => (
                                    <div key={name} className="p-3 border-b border-gray-50 last:border-0 hover:bg-blue-50 cursor-pointer flex justify-between items-center group active:bg-blue-100" onMouseDown={(e) => { e.preventDefault(); handleSelect(name); }}>
                                        <div className="flex flex-col"><span className="font-bold text-sm text-gray-800">{name}</span><div className="flex items-center gap-1 text-[10px] text-gray-400"><Icons.Clock size={10} /><span>ä¸Šæ¬¡: {usageHistory[name] ? new Date(usageHistory[name]).toLocaleDateString() : 'ä»æœª'}</span></div></div>
                                        <div className="flex flex-col items-end"><span className="text-blue-600 font-bold text-xs">{priceDB[name] ? `Â¥${priceDB[name]}` : 'Â¥0'}</span><span className="text-[10px] text-gray-400 group-hover:text-blue-400 transition-colors">ç‚¹å‡»æ·»åŠ </span></div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const App = () => {
            const [priceDB, setPriceDB] = useState(() => JSON.parse(localStorage.getItem('inventory_price_db')) || {});
            const [currentOrder, setCurrentOrder] = useState(() => JSON.parse(localStorage.getItem('inventory_current_order')) || []);
            const [orderHistory, setOrderHistory] = useState(() => JSON.parse(localStorage.getItem('inventory_history')) || []);
            const [goodsList, setGoodsList] = useState(() => JSON.parse(localStorage.getItem('inventory_goods_list')) || []);
            const [usageHistory, setUsageHistory] = useState(() => JSON.parse(localStorage.getItem('inventory_usage_history')) || {});
            const [currentRemark, setCurrentRemark] = useState("");

            const [activeTab, setActiveTab] = useState('current');
            const [inputName, setInputName] = useState("");
            const [lastAddedId, setLastAddedId] = useState(null);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [currentDate, setCurrentDate] = useState(new Date());
            const [selectedDayDetail, setSelectedDayDetail] = useState(null);
            const [selectedGoodFilter, setSelectedGoodFilter] = useState(null);
            const [isGoodsExpanded, setIsGoodsExpanded] = useState(false);
            const [editingOrderId, setEditingOrderId] = useState(null);

            const [modalConfig, setModalConfig] = useState({ isOpen: false });
            const [toastConfig, setToastConfig] = useState({ show: false, message: '', type: 'success' });
            const fileInputRef = useRef(null);

            useEffect(() => { localStorage.setItem('inventory_current_order', JSON.stringify(currentOrder)); }, [currentOrder]);
            useEffect(() => { localStorage.setItem('inventory_history', JSON.stringify(orderHistory)); }, [orderHistory]);
            useEffect(() => { localStorage.setItem('inventory_price_db', JSON.stringify(priceDB)); }, [priceDB]);
            useEffect(() => { localStorage.setItem('inventory_goods_list', JSON.stringify(goodsList)); }, [goodsList]);
            useEffect(() => { localStorage.setItem('inventory_usage_history', JSON.stringify(usageHistory)); }, [usageHistory]);

            const showToast = (msg, type = 'success') => { setToastConfig({ show: true, message: msg, type }); setTimeout(() => setToastConfig(prev => ({ ...prev, show: false })), 2000); };
            const safeNumberInput = (value) => { let num = parseFloat(value); return (isNaN(num) || num < 0) ? 0 : num; };

            const updateGoodsLibrary = (name) => { if (!name) return; const item = name.trim(); if (!item) return; setUsageHistory(prev => ({ ...prev, [item]: Date.now() })); if (!goodsList.includes(item)) setGoodsList([item, ...goodsList]); };
            const removeGoodFromLibrary = (good) => { if (confirm(`åˆ é™¤â€œ${good}â€ï¼Ÿ`)) setGoodsList(goodsList.filter(g => g !== good)); };
            const addItemToOrder = (name) => {
                if (!name.trim()) return; const finalName = name.trim(); const now = Date.now(); updateGoodsLibrary(finalName);
                const existingIndex = currentOrder.findIndex(item => item.name === finalName);
                if (existingIndex !== -1) { const newOrder = [...currentOrder]; newOrder[existingIndex].qty += 1; setCurrentOrder(newOrder); setLastAddedId(newOrder[existingIndex].id); }
                else { const newItem = { id: now, name: finalName, price: priceDB[finalName] || 0, qty: 1 }; setCurrentOrder([newItem, ...currentOrder]); setLastAddedId(newItem.id); }
                setTimeout(() => setLastAddedId(null), 800); if (navigator.vibrate) navigator.vibrate(50);
            };
            const updateCurrentItem = (id, field, value) => { const safeValue = safeNumberInput(value); setCurrentOrder(prev => prev.map(item => { if (item.id === id) { const updated = { ...item, [field]: safeValue }; if (field === 'price') setPriceDB(prev => ({ ...prev, [item.name]: safeValue })); return updated; } return item; })); };
            const deleteCurrentItem = (id) => { setModalConfig({ isOpen: true, title: "ç§»é™¤å•†å“", content: "ç¡®å®šç§»é™¤å—ï¼Ÿ", isDangerous: true, onConfirm: () => { setCurrentOrder(prev => prev.filter(item => item.id !== id)); setModalConfig({ isOpen: false }); }, onCancel: () => setModalConfig({ isOpen: false }) }); };
            const saveCurrentOrder = () => {
                if (currentOrder.length === 0) return showToast("æ¸…å•ä¸ºç©º", "error");
                setModalConfig({
                    isOpen: true, title: "ç¡®è®¤å½’æ¡£", content: `å…± ${currentOrder.length} é¡¹å•†å“`, onConfirm: () => {
                        const totalQty = currentOrder.reduce((sum, i) => sum + Number(i.qty), 0); const totalAmount = currentOrder.reduce((sum, i) => sum + (Number(i.price) * Number(i.qty)), 0);
                        setOrderHistory([{ id: Date.now(), date: Date.now(), totalQty, totalAmount, items: [...currentOrder], remark: currentRemark }, ...orderHistory]);
                        setCurrentOrder([]); setCurrentRemark(""); setModalConfig({ isOpen: false }); showToast("å½’æ¡£æˆåŠŸ");
                    }, onCancel: () => setModalConfig({ isOpen: false })
                });
            };

            const editingOrder = useMemo(() => orderHistory.find(o => o.id === editingOrderId), [orderHistory, editingOrderId]);
            const updateHistoryItem = (orderId, itemId, field, value) => {
                const safeValue = safeNumberInput(value);
                setOrderHistory(prev => prev.map(order => {
                    if (order.id !== orderId) return order;
                    const updatedItems = order.items.map(item => item.id === itemId ? { ...item, [field]: safeValue } : item);
                    const newTotalQty = updatedItems.reduce((s, i) => s + Number(i.qty || 0), 0);
                    const newTotalAmount = updatedItems.reduce((s, i) => s + (Number(i.price || 0) * Number(i.qty || 0)), 0);
                    return { ...order, items: updatedItems, totalQty: newTotalQty, totalAmount: newTotalAmount, lastModified: Date.now() };
                }));
            };
            const updateHistoryOrderRemark = (orderId, remark) => { setOrderHistory(prev => prev.map(order => order.id === orderId ? { ...order, remark, lastModified: Date.now() } : order)); };
            const deleteHistoryItem = (orderId, itemId) => {
                setModalConfig({
                    isOpen: true, title: "åˆ é™¤æ¡ç›®", content: "ç¡®å®šåˆ é™¤å—ï¼Ÿ", isDangerous: true, onConfirm: () => {
                        setOrderHistory(prev => prev.map(order => {
                            if (order.id !== orderId) return order;
                            const updatedItems = order.items.filter(item => item.id !== itemId);
                            const newTotalQty = updatedItems.reduce((s, i) => s + Number(i.qty || 0), 0);
                            const newTotalAmount = updatedItems.reduce((s, i) => s + (Number(i.price || 0) * Number(i.qty || 0)), 0);
                            return { ...order, items: updatedItems, totalQty: newTotalQty, totalAmount: newTotalAmount, lastModified: Date.now() };
                        }).filter(order => order.items.length > 0));
                        setModalConfig({ isOpen: false }); showToast("å·²åˆ é™¤");
                    }, onCancel: () => setModalConfig({ isOpen: false })
                });
            };
            const deleteHistoryOrder = (orderId) => {
                setModalConfig({
                    isOpen: true, title: "åˆ é™¤æ•´å•", content: "æ“ä½œä¸å¯é€†", isDangerous: true, onConfirm: () => {
                        setOrderHistory(prev => prev.filter(o => o.id !== orderId)); setEditingOrderId(null); setModalConfig({ isOpen: false }); showToast("å·²åˆ é™¤æ•´å•");
                    }, onCancel: () => setModalConfig({ isOpen: false })
                });
            };

            // --- ä¿®å¤åçš„åŠŸèƒ½å®ç° ---
            const copyOrderText = (orderItems, dateStr = "å½“å‰", remark = "") => {
                if (!orderItems || orderItems.length === 0) return showToast("æ— æ•°æ®", "error");
                const tQty = orderItems.reduce((s, i) => s + Number(i.qty || 0), 0);
                const tAmt = orderItems.reduce((s, i) => s + (Number(i.price || 0) * Number(i.qty || 0)), 0);
                let text = `ğŸ“… å‡ºåº“å• (${dateStr})\n----------------\n`;
                orderItems.forEach(item => text += `${item.name}\n   x${item.qty}  (Â¥${item.price}/ä¸ª)  = Â¥${(Number(item.price) * Number(item.qty)).toFixed(2)}\n`);
                text += `----------------\næ€»æ•°é‡: ${tQty}\næ€»é‡‘é¢: Â¥${tAmt.toFixed(2)}\n`;
                if (remark) text += `å¤‡æ³¨: ${remark}\n`;
                const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select();
                try { document.execCommand('copy'); showToast("å®Œæ•´æ¸…å•å·²å¤åˆ¶"); } catch (e) { showToast("å¤åˆ¶å¤±è´¥", "error"); }
                document.body.removeChild(ta);
            };

            const exportOrderExcel = (orderItems, filename, remark) => {
                if (!orderItems || orderItems.length === 0) return showToast("æ— æ•°æ®", "error");
                const data = orderItems.map(i => ({ "å•†å“åç§°": i.name, "å•ä»·": i.price, "æ•°é‡": i.qty, "å°è®¡": ((i.price || 0) * (i.qty || 0)).toFixed(2) }));
                data.push({ "å•†å“åç§°": "æ€»è®¡", "æ•°é‡": orderItems.reduce((s, i) => s + Number(i.qty || 0), 0), "å°è®¡": orderItems.reduce((s, i) => s + ((i.price || 0) * (i.qty || 0)), 0).toFixed(2) });
                if (remark) data.push({ "å•†å“åç§°": "å¤‡æ³¨", "å•ä»·": remark });
                const ws = XLSX.utils.json_to_sheet(data); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
                try { XLSX.writeFile(wb, filename + ".xlsx"); showToast("å¯¼å‡ºæˆåŠŸ"); } catch (e) { showToast("å¯¼å‡ºå¤±è´¥", "error"); }
            };

            const exportBackup = () => {
                try {
                    const data = { version: '2.3', orderHistory, priceDB, goodsList, usageHistory };
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `Backup_${new Date().toISOString().slice(0, 10)}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a); showToast("å¤‡ä»½å·²ä¸‹è½½");
                } catch (e) { showToast("å¤‡ä»½å¤±è´¥", "error"); }
            };

            const handleRestore = (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (ev) => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (confirm(`ç¡®å®šæ¢å¤æ•°æ®å—ï¼Ÿ\nåŒ…å« ${data.orderHistory?.length || 0} æ¡å†å²è®°å½•`)) {
                            if (data.orderHistory) setOrderHistory(data.orderHistory); if (data.priceDB) setPriceDB(data.priceDB); if (data.goodsList) setGoodsList(data.goodsList); if (data.usageHistory) setUsageHistory(data.usageHistory);
                            showToast("æ•°æ®å·²æ¢å¤"); setIsSettingsOpen(false);
                        }
                    } catch (err) { showToast("æ–‡ä»¶æ ¼å¼é”™è¯¯", "error"); }
                }; reader.readAsText(file); e.target.value = '';
            };

            const statsData = useMemo(() => {
                const todayStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate()).getTime();
                const monthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getTime();
                const yearStart = new Date(currentDate.getFullYear(), 0, 1).getTime();
                let todayCount = 0, monthCount = 0, yearCount = 0;

                const filteredOrders = orderHistory.map(order => {
                    const items = order.items || [];
                    const validItems = selectedGoodFilter ? items.filter(i => i.name === selectedGoodFilter) : items;
                    return { ...order, items: validItems, computedQty: validItems.reduce((s, i) => s + Number(i.qty || 0), 0), computedAmt: validItems.reduce((s, i) => s + (Number(i.price || 0) * Number(i.qty || 0)), 0) };
                }).filter(o => o.computedQty > 0);

                filteredOrders.forEach(o => {
                    if (o.date >= new Date().setHours(0, 0, 0, 0)) todayCount += o.computedQty;
                    if (o.date >= new Date(new Date().getFullYear(), new Date().getMonth(), 1).getTime()) monthCount += o.computedQty;
                    if (o.date >= new Date(new Date().getFullYear(), 0, 1).getTime()) yearCount += o.computedQty;
                });

                const daysInMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
                const calendarDays = Array(new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay()).fill({ empty: true });
                for (let d = 1; d <= daysInMonth; d++) {
                    const dayStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), d).getTime();
                    const dayEnd = new Date(currentDate.getFullYear(), currentDate.getMonth(), d, 23, 59, 59).getTime();
                    const dayOrders = filteredOrders.filter(o => o.date >= dayStart && o.date <= dayEnd);
                    calendarDays.push({ day: d, date: new Date(dayStart), count: dayOrders.reduce((s, o) => s + o.computedQty, 0), hasData: dayOrders.length > 0, orders: dayOrders });
                }
                return { todayCount, monthCount, yearCount, calendarDays };
            }, [orderHistory, currentDate, selectedGoodFilter]);

            const selectedDayDetails = useMemo(() => {
                if (!selectedDayDetail) return [];
                const target = statsData.calendarDays.find(d => !d.empty && d.date.getTime() === selectedDayDetail);
                return target ? target.orders : [];
            }, [selectedDayDetail, statsData]);

            // ä¿®å¤ï¼šå¿…é¡»åœ¨æ­¤å¤„å®šä¹‰ currentTotalAmountï¼Œå¦åˆ™ JSX ä¸­æ— æ³•ä½¿ç”¨
            const currentTotalAmount = currentOrder.reduce((sum, i) => sum + (Number(i.price || 0) * Number(i.qty || 0)), 0).toFixed(2);

            return (
                <div className="min-h-screen bg-gray-50 flex flex-col pb-20 max-w-lg mx-auto shadow-2xl relative overflow-hidden">
                    <ConfirmModal {...modalConfig} />
                    <Toast {...toastConfig} />

                    <div className="bg-white border-b border-gray-200 sticky top-0 z-30 pt-safe-top">
                        <div className="px-4 h-14 flex items-center justify-between">
                            <h1 className="font-bold text-lg text-slate-800">{activeTab === 'current' ? 'å‡ºåº“å¼€å•' : 'ç»Ÿè®¡æŠ¥è¡¨'}</h1>
                            <div className="flex gap-4">
                                {activeTab === 'history' && <button onClick={() => { setCurrentDate(new Date()); setSelectedDayDetail(null); }} className="text-xs font-bold bg-blue-50 text-blue-600 px-3 py-1.5 rounded-full flex items-center gap-1"><Icons.Today size={14} /> å›ä»Šå¤©</button>}
                                <button onClick={() => setIsSettingsOpen(true)} className="p-2 text-blue-600"><Icons.Settings size={22} /></button>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto">
                        {activeTab === 'current' ? (
                            <div className="flex flex-col min-h-full">
                                <div className="p-3 bg-white border-b border-gray-100 flex gap-2 items-center sticky top-0 z-20">
                                    <SmartNameInput goodsList={goodsList} priceDB={priceDB} usageHistory={usageHistory} currentInput={inputName} setCurrentInput={setInputName} onAdd={addItemToOrder} />
                                    <button onClick={() => { if (inputName) { addItemToOrder(inputName); setInputName(''); } }} className="bg-blue-600 text-white px-5 h-12 rounded-lg font-bold text-sm shadow-sm">æ·»åŠ </button>
                                </div>
                                <div className="p-3 space-y-3 pb-32">
                                    {currentOrder.length === 0 ? <div className="text-center py-20 text-gray-400 text-sm">æš‚æ— å•†å“<br />è¯·è¾“å…¥åç§°æ·»åŠ </div> : currentOrder.map(item => (
                                        <div key={item.id} className={`bg-white rounded-xl p-3 shadow-sm border border-gray-100 transition-all ${lastAddedId === item.id ? 'row-highlight' : ''}`}>
                                            <div className="flex justify-between items-start mb-3"><div className="flex-1 mr-2"><input type="text" className="font-bold text-lg w-full bg-transparent outline-none" value={item.name} onChange={e => updateCurrentItem(item.id, 'name', e.target.value)} /></div><button onClick={() => deleteCurrentItem(item.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash /></button></div>
                                            <div className="flex justify-between items-center bg-gray-50 p-2 rounded-lg"><div className="flex items-center gap-1"><span className="text-gray-400 text-xs">Â¥</span><input type="number" className="w-16 bg-transparent font-bold outline-none" value={item.price} onChange={e => updateCurrentItem(item.id, 'price', e.target.value)} /></div><div className="flex items-center gap-2"><button onClick={() => updateCurrentItem(item.id, 'qty', Math.max(1, Number(item.qty) - 1))} className="w-8 h-8 bg-white border rounded-lg flex justify-center items-center"><Icons.Minus size={16} /></button><input type="number" className="w-12 text-center bg-transparent font-bold text-lg outline-none" value={item.qty} onChange={e => updateCurrentItem(item.id, 'qty', e.target.value)} /><button onClick={() => updateCurrentItem(item.id, 'qty', Number(item.qty) + 1)} className="w-8 h-8 bg-white border rounded-lg flex justify-center items-center"><Icons.Plus size={16} /></button></div></div>
                                        </div>
                                    ))}
                                    {currentOrder.length > 0 && <div className="bg-white rounded-xl p-3 shadow-sm border border-gray-100 mt-2"><div className="flex items-center gap-2 mb-2 text-sm font-bold text-gray-700"><Icons.Edit size={16} /> <span>å¤‡æ³¨</span></div><textarea className="w-full bg-gray-50 rounded-lg p-2 text-sm outline-none resize-none" rows="2" placeholder="ä¾‹å¦‚ï¼šå®¢æˆ·è‡ªæ..." value={currentRemark} onChange={e => setCurrentRemark(e.target.value)} /></div>}
                                </div>
                            </div>
                        ) : (
                            <div className="p-4 space-y-4 pb-24 animate-fade-in">
                                <div className="relative">
                                    {!isGoodsExpanded ? (
                                        <div className="flex items-center gap-2"><div className="flex-1 flex gap-2 overflow-x-auto hide-scrollbar pb-1 pr-8"><button onClick={() => setSelectedGoodFilter(null)} className={`px-3 py-1.5 rounded-full text-xs font-bold border ${!selectedGoodFilter ? 'bg-blue-600 text-white' : 'bg-white'}`}>å…¨éƒ¨</button>{goodsList.map(good => (<button key={good} onClick={() => setSelectedGoodFilter(good)} className={`px-3 py-1.5 rounded-full text-xs font-bold border ${selectedGoodFilter === good ? 'bg-blue-600 text-white' : 'bg-white'}`}>{good}</button>))}</div><button onClick={() => setIsGoodsExpanded(true)} className="absolute right-0 bg-white p-1.5 rounded-full shadow-sm border"><Icons.ChevronDown size={16} /></button></div>
                                    ) : (
                                        <div className="bg-white rounded-2xl p-3 shadow-sm border z-10"><div className="flex justify-between mb-3"><span className="text-xs font-bold text-gray-400">é€‰æ‹©è´§ç‰©</span><button onClick={() => setIsGoodsExpanded(false)}><Icons.ChevronUp size={16} /></button></div><div className="grid grid-cols-3 gap-2 max-h-60 overflow-y-auto"><button onClick={() => { setSelectedGoodFilter(null); setIsGoodsExpanded(false); }} className="px-2 py-2 rounded-lg text-xs font-bold border">å…¨éƒ¨</button>{goodsList.map(g => (<button key={g} onClick={() => { setSelectedGoodFilter(g); setIsGoodsExpanded(false); }} className="px-2 py-2 rounded-lg text-xs font-bold border">{g}</button>))}</div></div>
                                    )}
                                </div>

                                <div className="grid grid-cols-3 gap-3">
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border text-center"><div className="text-xs text-gray-400 mb-1">ä»Šæ—¥</div><div className="text-xl font-bold">{statsData.todayCount}</div></div>
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border text-center"><div className="text-xs text-gray-400 mb-1">æœ¬æœˆ</div><div className="text-xl font-bold text-blue-600">{statsData.monthCount}</div></div>
                                    <div className="bg-white p-3 rounded-2xl shadow-sm border text-center"><div className="text-xs text-gray-400 mb-1">æœ¬å¹´</div><div className="text-xl font-bold">{statsData.yearCount}</div></div>
                                </div>

                                <div className="bg-white rounded-2xl p-4 shadow-sm border border-gray-100">
                                    <div className="flex justify-between items-center mb-4"><button onClick={() => { const d = new Date(currentDate); d.setMonth(d.getMonth() - 1); setCurrentDate(d); setSelectedDayDetail(null); }}><Icons.ChevronLeft size={20} /></button><span className="font-bold">{currentDate.getFullYear()}å¹´ {currentDate.getMonth() + 1}æœˆ</span><button onClick={() => { const d = new Date(currentDate); d.setMonth(d.getMonth() + 1); setCurrentDate(d); setSelectedDayDetail(null); }}><Icons.ChevronRight size={20} /></button></div>
                                    <div className="grid grid-cols-7 mb-2 text-center text-xs text-gray-400"><div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div></div>
                                    <div className="calendar-grid">{statsData.calendarDays.map((item, i) => item.empty ? <div key={i}></div> : <div key={i} onClick={() => item.hasData && setSelectedDayDetail(item.date.getTime())} className={`calendar-day ${item.hasData ? 'active cursor-pointer' : ''} ${selectedDayDetail === item.date.getTime() ? 'selected' : ''}`}><span>{item.day}</span>{item.hasData && <div className="text-[9px] text-gray-400">{item.count}</div>}</div>)}</div>
                                </div>

                                {selectedDayDetails.length > 0 && (
                                    <div className="animate-slide-up space-y-3">
                                        <div className="text-xs font-bold text-gray-400 pl-1">{new Date(selectedDayDetail).getMonth() + 1}æœˆ{new Date(selectedDayDetail).getDate()}æ—¥ è®°å½• ({selectedDayDetails.length}å•)</div>
                                        {selectedDayDetails.map(order => (
                                            <div key={order.id} onClick={() => setEditingOrderId(order.id)} className="bg-white rounded-xl p-4 shadow-sm border border-gray-100 cursor-pointer hover:bg-gray-50">
                                                <div className="flex justify-between items-center mb-2">
                                                    <div className="flex flex-col"><span className="text-sm font-bold">{new Date(order.date).toLocaleTimeString()}</span><span className="text-xs text-gray-400">{order.items.length}ç§å•†å“</span></div>
                                                    <div className="flex items-center gap-1"><span className="text-blue-600 font-bold">Â¥{(order.computedAmt || 0).toFixed(2)}</span><Icons.ChevronRight size={16} className="text-gray-300" /></div>
                                                </div>
                                                {/* ä¼˜åŒ–ç‚¹ï¼šç›´æ¥å±•ç¤ºæ¯å•è¯¦æƒ… */}
                                                <div className="text-xs text-gray-500 space-y-1">
                                                    {order.items.map((it, idx) => (
                                                        <div key={idx} className="flex justify-between border-b border-gray-50 pb-1 last:border-0">
                                                            <span className="text-slate-700">{it.name}</span>
                                                            <span className="font-mono">x{it.qty}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {isSettingsOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
                            <div className="absolute inset-0 bg-black/40" onClick={() => setIsSettingsOpen(false)}></div>
                            <div className="bg-white w-full max-w-sm rounded-3xl z-10 p-5 shadow-2xl animate-scale-up">
                                <div className="flex justify-between mb-6"><h2 className="font-bold text-xl">è®¾ç½®</h2><button onClick={() => setIsSettingsOpen(false)} className="bg-gray-100 p-2 rounded-full"><Icons.X /></button></div>
                                <div className="space-y-4">
                                    <div className="grid grid-cols-2 gap-3">
                                        <button onClick={exportBackup} className="p-4 bg-gray-50 rounded-2xl flex flex-col items-center gap-2 active:bg-blue-50"><div className="text-blue-500"><Icons.Download /></div><span className="text-xs font-bold">å¤‡ä»½ JSON</span></button>
                                        <label className="p-4 bg-gray-50 rounded-2xl flex flex-col items-center gap-2 active:bg-orange-50 cursor-pointer"><div className="text-orange-500"><Icons.Upload /></div><span className="text-xs font-bold">æ¢å¤å¤‡ä»½</span><input type="file" ref={fileInputRef} onChange={handleRestore} className="hidden" accept=".json" /></label>
                                    </div>
                                    <div className="pt-4 border-t"><h3 className="text-xs font-bold text-gray-400 mb-3">å¸¸ç”¨è´§ç‰©åº“ ({goodsList.length})</h3><div className="flex flex-wrap gap-2">{goodsList.map(g => <span key={g} onClick={() => removeGoodFromLibrary(g)} className="px-2 py-1 bg-gray-100 rounded-lg text-xs cursor-pointer hover:text-red-500">{g}</span>)}</div></div>
                                </div>
                            </div>
                        </div>
                    )}

                    {editingOrder && (
                        <div className="fixed inset-0 z-50 bg-gray-100 flex flex-col animate-slide-in-right">
                            <div className="bg-white px-4 h-14 border-b flex items-center justify-between pt-safe-top shrink-0"><button onClick={() => setEditingOrderId(null)} className="text-blue-600 font-bold text-sm flex items-center"><Icons.ChevronLeft size={20} /> è¿”å›</button><span className="font-bold text-sm">å•æ®è¯¦æƒ…</span><div className="w-10"></div></div>
                            <div className="flex-1 overflow-y-auto p-4 pb-32 space-y-3">
                                <div className="text-xs text-gray-400 text-center mb-4">{new Date(editingOrder.date).toLocaleString()} {editingOrder.lastModified && <span>Â· ç¼–è¾‘äº {timeAgo(editingOrder.lastModified)}</span>}</div>
                                {editingOrder.items.map((it) => (
                                    <div key={it.id} className="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                        <div className="flex justify-between mb-2"><span className="font-bold">{it.name}</span><button onClick={() => deleteHistoryItem(editingOrder.id, it.id)} className="text-gray-300 hover:text-red-500"><Icons.Trash size={16} /></button></div>
                                        <div className="flex justify-between items-center bg-gray-50 p-2 rounded-lg"><div className="flex items-center gap-1 text-xs">Â¥<input type="number" className="w-10 bg-transparent font-bold outline-none" value={it.price} onChange={(e) => updateHistoryItem(editingOrder.id, it.id, 'price', e.target.value)} /></div><div className="flex items-center gap-2 text-xs">x<input type="number" className="w-8 text-center bg-transparent font-bold outline-none" value={it.qty} onChange={(e) => updateHistoryItem(editingOrder.id, it.id, 'qty', e.target.value)} /></div></div>
                                    </div>
                                ))}
                                <div className="bg-white rounded-xl p-3 mt-4"><div className="flex items-center gap-2 mb-2 text-sm font-bold"><Icons.Edit size={16} /> å¤‡æ³¨</div><textarea className="w-full bg-gray-50 rounded-lg p-2 text-sm outline-none" rows="2" value={editingOrder.remark || ''} onChange={e => updateHistoryOrderRemark(editingOrder.id, e.target.value)} /></div>
                            </div>
                            <div className="bg-white border-t p-4 pb-safe-bottom safe-area-bottom flex gap-3"><button onClick={() => deleteHistoryOrder(editingOrder.id)} className="flex-1 py-3 bg-red-50 text-red-600 font-bold rounded-xl">åˆ é™¤å•æ®</button><button onClick={() => setEditingOrderId(null)} className="flex-[2] py-3 bg-blue-600 text-white font-bold rounded-xl shadow-lg">å®Œæˆä¿®æ”¹</button></div>
                        </div>
                    )}

                    {activeTab === 'current' && (
                        <div className="absolute bottom-16 left-4 right-4 bg-white/90 backdrop-blur-md border border-gray-200 shadow-lg rounded-2xl p-3 pb-safe-bottom z-40 animate-slide-up">
                            <div className="flex justify-between items-center mb-3 px-1"><span className="text-sm text-gray-500 font-medium">æœ¬å•åˆè®¡</span><span className="text-xl font-bold text-red-600">Â¥ {currentTotalAmount}</span></div>
                            <div className="flex gap-2"><button onClick={() => copyOrderText(currentOrder, "å½“å‰", currentRemark)} className="flex-1 py-3 bg-blue-50 text-blue-600 font-bold rounded-xl flex items-center justify-center gap-1 active:scale-95 transition-transform"><Icons.Copy size={16} /> å¤åˆ¶</button><button onClick={() => exportOrderExcel(currentOrder, `å‡ºåº“å•_${Date.now()}`, currentRemark)} className="w-12 bg-green-50 text-green-600 rounded-xl flex items-center justify-center active:scale-95 transition-transform"><Icons.Share size={16} /></button><button onClick={saveCurrentOrder} className="flex-[1.5] py-3 bg-blue-600 text-white font-bold rounded-xl flex items-center justify-center gap-1 shadow-lg shadow-blue-500/30 active:scale-95 transition-transform"><Icons.Save size={16} /> å½’æ¡£</button></div>
                        </div>
                    )}

                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 pb-safe-bottom z-50 h-16 flex items-center justify-around max-w-lg mx-auto">
                        <button onClick={() => setActiveTab('current')} className={`flex flex-col items-center gap-1 w-16 ${activeTab === 'current' ? 'text-blue-600' : 'text-gray-400'}`}><Icons.Package size={24} /><span className="text-[10px] font-medium">å¼€å•</span></button>
                        <button onClick={() => setActiveTab('history')} className={`flex flex-col items-center gap-1 w-16 ${activeTab === 'history' ? 'text-blue-600' : 'text-gray-400'}`}><Icons.History size={24} /><span className="text-[10px] font-medium">æŠ¥è¡¨</span></button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>

//251128-1
/*
1. å¯¹äºç»Ÿè®¡éƒ¨åˆ†ï¼Œé™¤äº†èƒ½ä¸ªçœ‹åˆ°å…·ä½“æ¯å•çš„ç»†èŠ‚ï¼Œè¿˜è¦èƒ½å¤Ÿçœ‹åˆ°å„ä¸ªè´§ç‰©å•ç‹¬çš„æ¯æ—¥çš„æ€»å‡ºåº“æ•°é‡ï¼Œæ¯æœˆçš„æ€»å‡ºåº“æ•°é‡ï¼Œæ¯å¹´çš„æ€»å‡ºåº“æ•°é‡
2. é™¤äº†æ‰«ç å’Œæ‰‹åŠ¨è¾“å…¥æ¡ç å¤–ï¼Œè¿˜åº”è¯¥èƒ½å¤Ÿæ‰‹åŠ¨è¾“å…¥è´§ç‰©åç§°æ¥è¿›è¡Œæ·»åŠ ï¼Œä¸”å¡«å†™è´§ç‰©åç§°æ—¶å¡«å†™æ¡†ä¸‹åº”è¯¥å‡ºç°å¤šåˆ—çš„è”æƒ³æç¤º
3. å¯¹äºæ‰«ç æ“ä½œæ—¶ï¼Œä¸åº”è¯¥ä¸€ç›´æ‰«æï¼Œè€Œæ˜¯åº”è¯¥æ‰«æä¸€ä¸ªåå°±æš‚æ—¶è¿”å›åˆ°æ€»è§ˆé¡µé¢ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿåšä¸€äº›ç¡®è®¤å¹¶ä¸”ä¹‹åæ‰‹åŠ¨å†æ¬¡æ‰“å¼€æ‰«æåŠŸèƒ½
*/

//251128-2
/*
1. åœ¨è®¾ç½®è´§ç‰©æ•°é‡æ—¶ï¼Œåº”è¯¥è¦èƒ½å¤Ÿæ‰‹åŠ¨å¡«å†™ï¼Œè€Œä¸ä»…ä»…æ˜¯é‡å¤ç‚¹å‡»åŠ å‡å·
2. åˆ›å»ºè´§ç‰©åº“çš„æ•°æ®åï¼Œè´§ç‰©åº”è¯¥æ˜¯ä»¥åç§°ä¸ºä¸»çš„ï¼Œè€Œä¸æ˜¯æ¡å½¢ç ã€‚æ‰€ä»¥æˆ‘çªç„¶å‘ç°ä¸æ¡å½¢ç æœ‰å…³çš„åŠŸèƒ½å¯ä»¥å…¨éƒ¨ç æ‰ï¼Œæ”¹ä¸ºæ¯æ¬¡æ‰‹åŠ¨å¡«å…¥è´§ç‰©åç§°æ¥é€æ¸å¡«å……è´§ç‰©åº“æ•°æ®å†…å®¹
3. æ—¥å†æ ·å¼çš„ç»Ÿè®¡åŠŸèƒ½ä¾æ—§éœ€è¦ï¼Œè¯¦æƒ…è¯·å®Œå…¨scanKuaidi.htmlçš„ç»Ÿè®¡åŠŸèƒ½
4. å¤åˆ¶çš„åŠŸèƒ½ä¸­åªå¤åˆ¶äº†æ•°é‡è€Œæ²¡æœ‰å¤åˆ¶ä»·æ ¼ï¼Œéœ€è¦æ·»åŠ ä¸Š
*/

//251128-3
/*
1. é¦–å…ˆè´§ç‰©åº“çš„å»ºç«‹è¦ç›´æ¥å‚è€ƒscanKuaidi.htmlä¸­çš„è´§ç‰©åº“ï¼Œå…¶æ¬¡ç»Ÿè®¡åŠŸèƒ½ä¸­ä¹Ÿè¦åƒscanKuaidi.htmlä¸­çš„ç»Ÿè®¡ä¸€èˆ¬ï¼Œèƒ½å¤Ÿç›´æ¥åœ¨ä¸Šé¢çš„é€‰æ‹©æ é€‰æ‹©éœ€è¦æŸ¥çœ‹çš„è´§ç‰©çš„æ€»ç»Ÿè®¡ã€‚
2. éœ€è¦å¤‡ä»½åŠŸèƒ½ï¼Œé€šè¿‡jsonæ–‡ä»¶å¤‡ä»½å’Œæ¢å¤ã€‚
*/

//251128-3
/*
1. åœ¨ç‚¹å‡»è¾“å…¥æ è¾“å…¥è´§ç‰©åç§°æ—¶ï¼Œåº”è¯¥åœ¨è¾“å…¥æ ä¸‹æ–¹å‡ºç°å¤šåˆ—è´§ç‰©åº“ä¸­çš„è”æƒ³æç¤ºï¼ˆæŒ‰å†å²æœ€è¿‘æ’åºï¼‰
2. å¤‡ä»½çš„åŠŸèƒ½ä¸­ï¼Œå¤‡ä»½æ–‡ä»¶çš„ä¸‹è½½åº”è¯¥ä»¥"Appåç§°_Backup_yyyy-mm-dd"å‘½å
*/

/*
//251128-4
1.
ç»Ÿè®¡åŠŸèƒ½ä¸­é€‰æ‹©æŸ¥çœ‹æŸä¸€å¤©çš„å…·ä½“è®°å½•æ—¶ï¼Œå…¶ä¸­çš„æ¯ä¸€å•çš„å†…å®¹éƒ½éœ€è¦æ˜¯å¯ç¼–è¾‘ä¿®æ”¹å’Œåˆ é™¤çš„ï¼Œåªéœ€åœ¨è¿›è¡Œæ“ä½œåæ·»åŠ ç±»ä¼¼â€œæœ€åç¼–è¾‘æ—¶é—´ï¼šâ€˜æ—¶é—´æˆ–å¤šä¹…å‰â€™â€ï¼Œè¿™é‡Œçš„â€˜æ—¶é—´æˆ–å¤šä¹…å‰â€™é‡‡ç”¨ä¸githubæœ€åæ›´æ–°æ—¶é—´ç›¸åŒçš„è®°å½•æ—¶é—´æ³•ï¼Œæˆ–è€…é’ˆå¯¹è¿™ç±»è®°å½•åŠŸèƒ½çš„appä½ æœ‰æ›´å¥½çš„è®°å½•æ—¶é—´æ³•éƒ½å¯ä»¥ä½¿ç”¨ã€‚
*/